name: Patch OTA with Magisk

on:
  push:
    branches:
      - main

jobs:
  patch-ota:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Download OTA update
      run: |
        wget -O ota.zip <URL_OF_OTA_UPDATE>

    - name: Install Magisk
      run: |
        wget -O magisk.apk <URL_OF_MAGISK_APK>
        unzip magisk.apk -d magisk

    - name: Patch OTA with Magisk
      run: |
        java -jar magisk/magisk.jar patch ota.zip

    - name: Upload patched image
      uses: actions/upload-artifact@v2
      with:
        name: patched-ota
        path: magisk/output/patched_image.img
